# Environment Variables Setup Guide

This guide explains how to set up environment variables for local development and production deployment.

## Quick Start

### For Local Development:

**Option 1: Using the setup script (Recommended)**
```bash
# On Linux/Mac
bash setup-env.sh

# On Windows (PowerShell)
.\setup-env.ps1
```

**Option 2: Manual setup**
```bash
# Copy the local environment file
cp .env.local .env

# Edit .env and add your Claude API key
# Get it from: https://console.anthropic.com/
```

### For Production Deployment:

Run the setup script and choose option 2, or manually copy `.env.production.template` and fill in the values.

---

## Required Environment Variables

### üî¥ Critical (Required for basic functionality)

| Variable | Description | Where to Get It |
|----------|-------------|-----------------|
| `CLAUDE_API_KEY` | Claude API key for RAG chatbot | [console.anthropic.com](https://console.anthropic.com/) |
| `JWT_SECRET` | Secret key for JWT tokens | Generate: `openssl rand -hex 32` |
| `DATABASE_URL` | PostgreSQL connection string | Auto-provided by Render/Railway |

### üü° Important (Recommended for full functionality)

| Variable | Description | Where to Get It |
|----------|-------------|-----------------|
| `QDRANT_URL` | Qdrant vector database URL | [cloud.qdrant.io](https://cloud.qdrant.io/) or `http://localhost:6333` |
| `QDRANT_API_KEY` | Qdrant API key (for cloud) | Qdrant Cloud dashboard |
| `CORS_ORIGINS` | Allowed frontend origins | Your Vercel URL after deployment |

### üü¢ Optional (Can be added later)

| Variable | Description | Default |
|----------|-------------|---------|
| `OLLAMA_URL` | Local embeddings service | Not set |
| `TRANSLATION_API_KEY` | Translation service key | Not set |
| `EMAIL_SMTP_HOST` | Email service for notifications | Not configured |

---

## Environment Files Overview

### `.env.local`
**Purpose**: Local development with Docker Compose
**Security**: Safe to commit (no real credentials)
**Usage**: Copy to `.env` and add your Claude API key

### `.env.production.template`
**Purpose**: Template for production deployment
**Security**: DO NOT commit with real values
**Usage**: Copy, fill with real credentials, use in hosting platform

### `.env.example`
**Purpose**: Documentation of all possible variables
**Security**: Safe to commit
**Usage**: Reference guide

### `.env` (you create this)
**Purpose**: Your actual local environment
**Security**: ‚ö†Ô∏è NEVER commit this file (already in .gitignore)
**Usage**: Used by Docker Compose

---

## Step-by-Step Setup

### Local Development

1. **Run the setup script**:
   ```bash
   # Linux/Mac
   bash setup-env.sh

   # Windows
   .\setup-env.ps1
   ```

2. **When prompted, enter**:
   - Claude API key (from console.anthropic.com)
   - Script will auto-generate JWT secret

3. **Start services**:
   ```bash
   docker-compose up
   ```

4. **Initialize database**:
   ```bash
   docker-compose exec backend alembic upgrade head
   docker-compose exec backend python scripts/seed_roles.py
   ```

### Production Deployment

#### Step 1: Prepare Environment Variables

1. **Run production setup**:
   ```bash
   bash setup-env.sh
   # Choose option 2
   ```

2. **Collect these values**:
   - Claude API key
   - Qdrant Cloud URL and API key (sign up at cloud.qdrant.io)
   - Deployment URLs (after deploying)

#### Step 2: Add to Vercel

1. Go to your Vercel project
2. Settings ‚Üí Environment Variables
3. Add:
   ```
   NODE_ENV=production
   BACKEND_API_URL=https://physicalai-backend.onrender.com
   RAG_WS_URL=wss://physicalai-rag.onrender.com
   ```

#### Step 3: Add to Render

For each service (backend, rag, agent):

1. Go to Service ‚Üí Environment tab
2. Add variables from `.env.production`
3. Click "Save Changes"

**Backend Service**:
```
DATABASE_URL=[auto-provided by Render PostgreSQL]
JWT_SECRET=[generated by setup script]
CORS_ORIGINS=https://your-vercel-app.vercel.app
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=7
```

**RAG Service**:
```
QDRANT_URL=https://your-cluster.qdrant.io
QDRANT_API_KEY=[from Qdrant Cloud]
CLAUDE_API_KEY=sk-ant-api03-...
CLAUDE_MODEL=claude-3-5-sonnet-20241022
```

**Agent Service**:
```
TRANSLATION_API_KEY=[optional]
```

---

## Security Best Practices

### ‚úÖ DO:
- Use the setup scripts to generate secure JWT secrets
- Store production credentials in hosting platform environment variables
- Use different API keys for development and production
- Enable `SESSION_COOKIE_SECURE=true` in production
- Use strong, unique passwords for PostgreSQL
- Rotate API keys periodically

### ‚ùå DON'T:
- Commit `.env` file to git
- Share API keys in chat/email
- Use development credentials in production
- Hardcode secrets in source code
- Reuse JWT secrets across environments

---

## Troubleshooting

### "Claude API key invalid"
- Verify key starts with `sk-ant-api03-`
- Check key is active in console.anthropic.com
- Ensure no extra spaces or quotes

### "Database connection failed"
- Check `DATABASE_URL` format: `postgresql://user:pass@host:port/db`
- Verify PostgreSQL service is running
- Check firewall/security group settings

### "Qdrant connection timeout"
- Verify Qdrant URL includes `https://` and port `:6333`
- Check API key is correct
- Ensure cluster is running in Qdrant Cloud

### "CORS errors in browser"
- Add your frontend URL to `CORS_ORIGINS`
- Include protocol: `https://your-app.vercel.app`
- Restart backend service after updating

---

## Environment Variable Reference

### Database Configuration
```bash
POSTGRES_USER=physicalai
POSTGRES_PASSWORD=strong-random-password
POSTGRES_DB=physicalai_db
DATABASE_URL=postgresql://user:pass@host:5432/db
```

### Authentication
```bash
JWT_SECRET=generated-64-character-hex-string
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=7
BCRYPT_ROUNDS=12
```

### Vector Database
```bash
QDRANT_URL=https://cluster-id.qdrant.io:6333
QDRANT_API_KEY=your-api-key
```

### AI Services
```bash
CLAUDE_API_KEY=sk-ant-api03-your-key
CLAUDE_MODEL=claude-3-5-sonnet-20241022
OLLAMA_URL=http://localhost:11434
```

### URLs and CORS
```bash
FRONTEND_URL=https://your-app.vercel.app
BACKEND_API_URL=https://api.your-domain.com
ALLOWED_ORIGINS=https://your-app.vercel.app
CORS_ORIGINS=https://your-app.vercel.app
```

### Logging and Monitoring
```bash
LOG_LEVEL=INFO
LOG_FORMAT=json
DEBUG=false
```

---

## Quick Reference Commands

**Generate JWT Secret**:
```bash
openssl rand -hex 32
```

**Test Database Connection**:
```bash
docker-compose exec backend python -c "from src.core.database import engine; engine.connect(); print('‚úì Connected')"
```

**Verify Environment File**:
```bash
# Check for unset variables
grep "CHANGE_ME\|YOUR_.*_HERE\|sk-ant-api03-YOUR" .env
```

**View Current Environment** (in Docker):
```bash
docker-compose exec backend env | grep -E "CLAUDE|QDRANT|DATABASE|JWT"
```

---

## Next Steps

After setting up environment variables:

1. **Local Development**: Follow [DEPLOY-NOW.md](./DEPLOY-NOW.md) Step 4-6
2. **Production**: Complete deployment to Vercel and Render
3. **Testing**: Verify all services are accessible
4. **Monitoring**: Set up alerts and logging

---

Built with Claude Code.
